let mapleader=","

" === Plugins ===
set easymotion
set NERDTree
set surround
set multiple-cursors
set commentary
set argtextobj
set textobj-entire
set ReplaceWithRegister
set exchange
set highlightedyank
set vim-paragraph-motion
set indent-object
" IdeaVimExtension plugin
set keep-english-in-normal-and-restore-in-insert

" === Action ===
nnoremap ]e :action GotoNextError<CR>
nnoremap [e :action GotoPreviousError<CR>
nnoremap K :action QuickJavaDoc<CR>
nnoremap gi :action GotoImplementation<cr>
nnoremap gr :action FindUsages<cr>
nnoremap <c-p> :action SearchEverywhere<CR>

" === Leader ===
" Borrow key mapping from https://github.com/danidiaz/miscellany/blob/master/windows/.ideavimrc
noremap \ ,

" Choose Window using Switcher
map <Leader>wc :action Switcher<CR>

" Hide tool window
map <Leader>zz :action HideActiveWindow<CR>

" NERDTree
map <leader>e :NERDTreeToggle<CR>

" ReplaceWithRegister
nmap <Leader>p  <Plug>ReplaceWithRegisterOperator
nmap <Leader>pp <Plug>ReplaceWithRegisterLine
xmap <Leader>p  <Plug>ReplaceWithRegisterVisual

" Generate
map <Leader>ge <Action>(Generate)

" SurroundWith
map <Leader>wr :action SurroundWith<CR>

" git
map <Leader>gg :action Git.Menu<CR>

" not working
" map [g :action NextDiff<CR>
" map ]g :action PreviousDiff<CR>

" show
map <Leader>se <Action>(ShowErrorDescription)
map <Leader>si <Action>(QuickImplementations)
nnoremap <Leader>sr :action ShowUsages<CR>

" tags
map <Leader>t <Action>(FileStructurePopup)

" Refactor
nnoremap <Leader>rr :action RefactoringMenu<CR>
nnoremap <Leader>rn :action RenameElement<CR>

" The default C-o and C-i behaviours have certain inconsistencies with
" Vim which I can't quite pinpoint.
" I'm using the default IntelliJ behaviours instead.
map <C-o> <Action>(Back)
map <C-i> <Action>(Forward)

" === Search ===
set ignorecase
set smartcase
set hlsearch
set incsearch

" === Miscellaneous ===
set noerrorbells visualbell t_vb=
set clipboard+=unnamed
nmap <C-h> gT
nmap <C-l> gt
set backspace=indent,eol,start
set hidden
set showcmd
" Always show the status line at the bottom, even if you only have one window open.
set laststatus=2
set wildmenu
set wildmode=full
set history=200
syntax on
set shortmess+=I
set number
set relativenumber
set mouse+=a
source $VIMRUNTIME/mswin.vim
set clipboard=unnamed
set splitbelow
set splitrigh

" Unbind some useless/annoying default key bindings.
nmap Q <Nop> " 'Q' in normal mode enters Ex mode. You almost never want this.
map <C-a> <Nop>
map <C-x> <Nop>

" Completion popup menu
inoremap <expr> <C-j> pumvisible() ? "\<C-n>" : "\<C-j>"
inoremap <expr> <C-k> pumvisible() ? "\<C-p>" : "\<C-k>"

" Moving lines
nnoremap <silent> <C-k> :move-2<cr>
nnoremap <silent> <C-j> :move+<cr>
xnoremap <silent> <C-k> :move-2<cr>gv
xnoremap <silent> <C-j> :move'>+<cr>gv

set showcmd             " show command in bottom bar

" === Plugins ===
map <Space> <Plug>(easymotion-prefix)
let g:EasyMotion_keys = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ;'
let g:argtextobj_pairs="[:],(:),<:>"
let g:highlightedyank_highlight_duration = "400"

" === Jetbrains IDE specific settings(not copy from .vimrc) ===
" copy paste cut
vnoremap <C-c> "+y
vnoremap <C-v> "+gP
inoremap <C-v> <C-o>"+gP

" Show a few lines of context around the cursor.  Note that this makes the
" text scroll if you mouse-click near the start or end of the window.
set scrolloff=3
" Ask help from nvim ;)
" https://www.reddit.com/r/IntelliJIDEA/comments/dphwrd/how_to_configure_ideavim_shortcut_to_open_file_in/
nmap ,v :action Tool_External Tools_nvim<cr>


" === Idea specific settings ===
set clipboard+=ideaput
set ideajoin
set ideastatusicon=gray
set idearefactormode=keep
" Sync IJ bookmarks and Vim marks
set ideamarks
